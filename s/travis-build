#!/bin/sh

ROOT=`pwd`

inifile() {
cd $ROOT
if [ ! -e eressea.ini ]; then
cp conf/eressea.ini .
$BUILD/iniparser/inifile eressea.ini add lua:paths lunit:scripts
fi
}

integration_tests() {
cd tests
./write-reports.sh
./run-turn.sh
}

set -e
[ -z $BUILD ] && BUILD=Debug ; export BUILD
s/cmake-init
cppcheck --version
cppcheck --quiet -Isrc -Iclibs -Istorage -IcJSON --error-exitcode=1 src
s/build
cd process
make
cd $ROOT
inifile
s/runtests -V
integration_tests
